<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">

		<title>Votre situation [Prototype]</title>

		<link href='http://fonts.googleapis.com/css?family=Oswald:400,700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Esteban&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


		<style type="text/css" media="screen">
			body {
				max-width: 60em;
				font-family: "Esteban", "Helvetica Neue", serif;
				background-color: #E3E3F3;
				margin: auto;
			}

			h1, h2, h3 {
				font-family: "Oswald", "Lucida Grande", sans-serif;
			}

			p, input, select, button {
				font-size: 120%;
			}

			p {
				display: none;
			}

			p.active {
				display: inline;
			}

			#geolocate {
				cursor: pointer;
				position: relative;
				top: .2em;
			}

			.inlineInput {
				color: blue;
				border-bottom: 1px dashed;
			}
		</style>
	</head>
	<body>
		<h1>Bienvenue !</h1>
		<h2>Pour déterminer les aides que l'État peut vous apporter, nous allons définir votre situation.</h2>

		<form>
			<p id="first">
				<strong>Aujourd’hui</strong>,
				vous avez
				<input required name="age" type="number" min="0" max="130" length="3" title="Entrez votre âge"/> <label for="age">ans</label> et
			</p>
			<p>
				vivez
				<select name="marital">
					<option value="seul">seul</option>
					<option value="en concubinage">en concubinage</option>
					<option value="pacsé.e">pacsé.e</option>
					<option value="marié.e">marié.e</option>
				</select>
			</p>
			<p>
				à
				<input required name="town" placeholder="ville ou code postal"/>
				<!-- <img id="geolocate" src="target.png" title="Utiliser votre position actuelle"/> -->
			</p>
			<p>
				dans un logement dont vous êtes
				<select name="tenancy">
					<option value="locataire">locataire</option>
					<option value="propriétaire">propriétaire</option>
				</select>
			</p>
			<p>
				pour un loyer de
				 <input required type="number" name="rent" length="4" min="0" max="9999"/><label for="rent">&nbsp;€ par mois</label>
				 .
			</p>
			<p>
				<br>
				<strong>Ces trois derniers mois</strong>,
				vous avez gagné <input required type="number" name="minus1" length="5" min="0"/><label for="minus">&nbsp;€ en février</label>
				,
			</p>
			<p>
				<input required type="number" name="minus2" length="5" min="0"/><label for="minus2">&nbsp;€ en janvier</label>
				,
			</p>
			<p>
				et
				<input required type="number" name="minus3" length="5" min="0"/><label for="minus3">&nbsp;€ en décembre 2013</label>
				.
			</p>
			<p>
				<input type="submit" value="Quelles aides puis-je demander ?"/>
			</p>
		</form>
	</body>

	<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
	<script type="text/javascript">
		$('input, select, #geolocate').on('click focus change', function(evt) {
			var target = $(evt.target);

			var next = target.parent().nextAll('p').first();
			next.addClass('active');

			if (! next.length) {
				submit($('form'));
			}

			var prevSegments = target.parent().prevAll('p');

			var deleted = prevSegments.find('input, select').filter(function(elm) {
				return this.checkValidity();
			}).replaceWith(function() {
				return '<span data-type="' + this.type + '" class="inlineInput">' + this.value + '</span>';
			});

			prevSegments.find('span').on('click', function(evt) {
				$(evt.target).replaceWith(function() {
					return deleted;
				});
			});
		});

		$('#geolocate').on('click', function() {
			window.setTimeout(function() {
				$('[name="town"]').val('Montreuil');
			}, 1000);
		});

		$('#first').addClass('active');

		$('form').submit(function(evt) {
			submit($(evt.target));
		});

		function submit(form) {
			console.log(form.serialize());
		}
	</script>
</html>
